# 微前端

## 概念
微前端是一种类似于微服务的架构，它将微服务的理念应用于浏览器端，即将单页面前端应用由单一的单体应用转变为多个小型前端应用聚合为一的应用。各个前端应用还可以独立开发、独立部署。同时，它们也可以在共享组件的同时进行并行开发——这些组件可以通过 NPM 或者 Git Tag、Git Submodule 来管理。

## 为什么需要微前端
![应用随着时间和空间所带来的问题](./img/应用的掣肘.jpg '')
* 空间分离带来的协作问题(巨石应用)
    - 工程越来越大，打包越来越慢
    - 团队人员多，产品功能复杂，代码冲突频繁、影响面大
    - 内心想做 SaaS 产品，但客户总是要做定制化
        > SaaS是Software-as-a-Service（软件即服务）的简称，随着互联网技术的发展和应用软件的成熟， 在21世纪开始兴起的一种完全创新的软件应用模式。它与“on-demand software”，the application service provider(ASP，应用服务提供商)，hosted software(托管软件)所具有相似的含义。它是一种通过Internet提供软件的模式，厂商将应用软件统一部署在自己的服务器上，客户可以根据自己实际需求，通过互联网向厂商定购所需的应用软件服务，按定购的服务多少和时间长短向厂商支付费用，并通过互联网获得厂商提供的服务。用户不用再购买软件，而改用向提供商租用基于Web的软件，来管理企业经营活动，且无需对软件进行维护，服务提供商会全权管理和维护软件，软件厂商在向客户提供互联网应用的同时，也提供软件的离线操作和本地数据存储，让用户随时随地都可以使用其定购的软件和服务。对于许多小型企业来说，SaaS是采用先进技术的最好途径，它消除了企业购买、构建和维护基础设施和应用程序的需要。
* 时间延续带来的升级维护
    > 几乎是所有年龄超过 3 年的 web 应用都会存在的问题
    
## 微前端核心价值（阿里大牛提出来的，个人表示赞同）
> [参考](https://zhuanlan.zhihu.com/p/95085796)
* 技术栈无关
    > 应用之间不应该有任何直接或间接的技术栈、依赖、以及实现上的耦合。比如我们不能要求子应用、主应用必须使用某一版本的技术栈实现。
    
    > 正确的微前端方案的目标应该是：方案上跟使用 iframe 做微前端一样简单，同时又解决了 iframe 带来的各种体验上的问题。
    
    > 理想状态下，以此为目标的微前端应用，是自动具备流通能力的，且这个流通能力不会因为主应用的实现升级而丧失（也就是说在 19 年能接入主应用的微前端应用，到了 2025 年也应该能正常接入正常运行，并同样保有在不同主应用间流通的能力）。           

## 微前端实现方案
[引用](https://tech.meituan.com/2020/02/27/meituan-waimai-micro-frontends-practice.html)
*****
[参考](https://baijiahao.baidu.com/s?id=1638313846156942854&wfr=spider&for=pc)
*****
* NPM式：子工程以NPM包的形式发布源码；打包构建发布还是由基座工程管理，打包时集成。
* iframe式：子工程可以使用不同技术栈；子工程之间完全独立，无任何依赖；基座工程和子工程需要建立通信机制；无单页应用体验；路由地址管理困难。
* 通用中心路由基座式：子工程可以使用不同技术栈；子工程之间完全独立，无任何依赖；统一由基座工程进行管理，按照DOM节点的注册、挂载、卸载来完成。
* 特定中心路由基座式：子业务线之间使用相同技术栈；基座工程和子工程可以单独开发单独部署；子工程有能力复用基座工程的公共基建。

|方案|技术栈是否统一|单独打包|单独部署|打包部署速度|单页应用体验|子工程切换速度|工程间通信难度|现有工程侵入性|学习成本|示例|
| ------ | --- |-------- | ------| --------- | -------- | ---------- | ---------- | ---------- | ----- | --- |
| NPM式 | Y（不强制）| N|N|慢|Y|快|正常|高|高| |
| iframe式 | Y（不强制）| Y|Y|正常|N|慢|高|高|低| |
| 通用中心路由基座式 | Y（不强制）| Y|Y|慢|Y|快|高|高|高| |
| 特定中心路由基座式 | Y（强制）| Y|Y|快|Y|快|正常|低|低|[美团实现具体方案](https://tech.meituan.com/2020/02/27/meituan-waimai-micro-frontends-practice.html) |

## 另外的一些方案
* 应用组件化。借助于 Web Components 技术，来构建跨框架的前端应用。
    > Web Components 是一套不同的技术，允许您创建可重用的定制元素（它们的功能封装在您的代码之外）并且在您的 Web 应用中使用它们。   
    
        - Custom elements，允许开发者创建自定义的元素，诸如 <today-news></today-news>。
        - Shadow DOM，即影子 DOM，通常是将 Shadow DOM 附加到主文档 DOM 中，并可以控制其关联的功能。而这个 Shadow DOM 则是不能直接用其它主文档 DOM 来控制的。
        - HTML templates，即 <template> 和 <slot> 元素，用于编写不在页面中显示的标记模板。
        - HTML Imports，用于引入自定义组件。
    > 缺点：浏览器兼容性不好
    
## 微前端需要考虑的功能点
* 基座模式 通过一个主应用，来管理其它应用。设计难度小，方便实践，但是通用度低。
    - 子系统应用注册
    - 路由
    - 全局数据管理中心
* 自组织模式 应用之间是平等的，不存在相互管理的模式。设计难度大，不方便实施，但是通用度高。

    

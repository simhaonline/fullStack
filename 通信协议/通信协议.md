# 通信协议

## 计算机网络协议
> 网络协议： 计算机网络和分布系统中相互通信的对等实体之间交换信息时必须遵守的规则的集合
* 负责在网络上建立通信通道和控制通信通道的信息流的规则
* 协议依赖于网络体系结构，由硬件和软件协同实现
* 网络体系结构： 指通信系统的整体设计方案，是计算机之间相互通信的层次、以及各层中的协议和层次之间的接口集合，他为网络硬件和软件、协议、存取、控制和网络图谱提供标准
### 网络协议三要素
> 语义表示要做什么，语法表示要怎么做，时序表示做的顺序。
* 语义： 解释控制信息每一部分的意义。规定了需要发出何种控制信息，以及完成的动作与做出何种响应
* 语法： 用户数据与控制信息的结构与格式，以及数据出现的顺序。
* 时序： 对事件发生顺序的详细说明。
## 开放系统互联参考模型
### OSI/RM 模型分层
* TCP/IP 4层模型
    - 应用层
    - 传输层
    - 网络层
    - 网络接口层
* TCP/IP 5层模型
    - 应用层
    - 传输层
    -  网络层
    - 数据链路层
    - 物理层
* OSI 7层模型
    - 应用层 Application Layer
    - 表示层 Pressentation Layer
    - 会话层 Session Layer
    - 传输层 Transport Layer
    - 网络层 NetWork Layer
    - 数据链路层 Data Link Layer
    - 物理层 Physics Layer
![数据传输](./数据传输.png '')
### 物理层
> 物理层的作用是传输电信号 规定 0 和 1 代表电压的高低， 规定网线和连接器的规格等。
> 物理层也叫时提出，就是用物理实体将电脑之间连接起来。
### 链路层
> 光有物理层远远不够， 0 和 1 究竟会怎么去组合，不同的划分代表了什么意思，这就需要链路层来处理，他将0 和 1 划分为具有意义的数据帧进行传输
 * 以太网
 
 |目标MAC地址|源MAC地址|类型|数据|FCS|
 | ---- | ---- | ---- | ---- | ---- |
 |6字节|6字节|2字节|46~1500字节|4字节|

 * MAC地址 相当于计算机的身份证号码，指网卡的mac地址
 > 数据包的传输就是网卡对网卡的传输
 * 广播
 > 网卡想知道另外一个网卡在哪儿， 必须在本网络中进行广播，目的网卡看到该广播则接收信息
 ### 网络层
 > 广播的方式是低效的， 而且只局限在发送者的子网络， name想要找到背的子网络的MAC地址，就需要internet将他们相互连接到一起。网络层就出现了， 让每一台主机都拥有一个除了MAC地址以外另外一个重要的东西：IP地址。IP地址能帮我们确定计算机所在的子网络。
 * IP地址
 * 子网掩码
    > 判断两个ip是否属于同一个网络，分别用这两个ip与子网掩码进行按位与运算，得出的结果相同证明属于同一网段
 * DNS domain name system
    > 默认网关，输入域名，dns检索对应IP数据库，迅速定位到对应的地址
 * ARP
    > 以目标IP为线索，定位对应的设备（路由器中ip与mac的映射）的mac地址，
 * IP数据包
    > 传给链路层
### 传输层
> 有了以上三次就可以建立通信了，但哪些数据究竟如何给电脑里面的应用程序呢？这就需要端口（port），通过不同的端口，服务器将数据分给不同程序（进程）。传输层就是建立端口到端口的通信，网络层是主机到主机的通信。只要确定了了端口和主机，那么就可以实现交流了
* UDP协议

* TCP协议
#### TCP - 三次握手&&四次挥手
* TCP三次握手
    - 第一次握手： A向B发送一个SKN=1,随机产生一个seq number=x,要求建立联机。
    - 第二次握手： B收到请求，向A发送一个ack number=x+1，sky=1，ack=1,并随机产生seq number=y
    - 第三次握手： A会检查B发送过来的ack number 是否为x+1，以及ack是否为1， 如果是，就像B发送一个ack number=y+1,ack=1，连接建立成功
    > [详细](https://baijiahao.baidu.com/s?id=1647167709154490152&wfr=spider&for=pc)
    > [详细](https://baijiahao.baidu.com/s?id=1654225744653405133&wfr=spider&for=pc)
* TCP四次挥手
    - 第一次： 甲向乙发送一个FIN报文：seq number=x,ack number=y 请求断开连接
    - 第二次： 乙向甲发送一个ack number=x+1,代表我统一你断开连接请求
    - 第三次： 乙向甲发送一个FIN报文：seq number=y 请求关闭连接
    - 第四次： 甲收到乙的报文，并发送ack number= y+1，乙收到这个报文就关闭连接，甲等待几秒后没有收到回复后，就说明对方已经关闭，于是甲也断开连接
### 会话层
> 会话层（Session）是建立在传输层上的，利用传输层提供的服务，使应用建立和维持会话，并能使会话获得同步。会话层使用校验点可以使通信会话在通信失效时从校验点继续回复通信（下载文件）
* 建立会话
    - 身份验证
    - 权限验证
* 保持会话
    - 有效时间内可以在该会话内传输数据
* 断开会话 
### 表示层
> 表示层为异种通信提供异种公共语言，以便进行交互操作。
表示层处理所有与数据表示及运输有关的问题，包括转码、加密、压缩。每台计算机都可能有自己的表示数据的方法，如ASCII码，所以需要表示层协议来保证不同计算机可以理解彼此。
[百度百科](https://baike.baidu.com/item/%E4%BC%9A%E8%AF%9D%E5%B1%82/4329656?fr=aladdin)
### 应用层
> 应用层也称为应用实体，它由若干个特定应用服务元素和一个或者多个公用应用服务元素组成，每个元素都提供特定的应用服务。

> 网络感知应用软件： 应用程序指人们用于网络通信的软件程序。有些终端用户应用程序是网络感知应用程序，即这些应用程序实现了应用层协议，并可以直接与协议栈的较低层通信。电子邮件客户端程序和web浏览器就属于这种类型的应用服务。
## HTTP协议详解
> http协议是Hyper text transfer protocol（超文本传输协议）的缩写，用来从万维网传输超文本到本地浏览器的传输协议。HTTP是基于TCP/IP通信协议来传递数据的，属于OSI/RM中的应用层协议。
* HTTP协议通常承载与TCP协议上，有时也承载与TLS或者SSL协议协议层上，这个时候就是我们常说的HTTPS。
* HTTP默认端口80，HTTPS默认端口403.
* 浏览网页时HTTP的主要应用，并不代表HTTP只能应用于网页浏览。HTTP是一种协议，只要通信的双方都遵守这种协议，http就有用武之地，比如我们常说的QQ，迅雷等软件，都会使用HTTP协议。
### http原理
* 客户端连接到web服务器
> 一个http客户端，通常是浏览器与web服务器的http端口（默认80），建立一个TCP套接字连接
* 发送http请求
> 通过TCP套接字，客户端向web服务器发送一个文本的请求报文。
* 服务器接收请求并返回HTTP响应
> web服务器解析请求，定位请求资源
* 释放TCP连接
> 若connection模式为close，则服务器主动关闭TCP请求，客户端被动关闭连接，释放TCP连接；若connection模式为keep-alive，则该连接会保持一段时间，在时间段内能继续接收请求。
* 客户端浏览器解析HTML内容
### 消息结构
* 客户端请求消息
    - 请求行
    - 请求头
    - 空行
    - 请求数据
### 工作流程
* 一次http操作称为一个事务，其工作分为四个步骤
    - 客户机建立连接。只要单机某个超级链接，http就开始了
    - 建立连接后，客户机发送一个请求给服务器，请求格式：统一资源定位符、协议版本号，后面是MIME信息、客户机信息和可能有的内容。
    - 服务器接收到请求后，给与相应的响应数据，其格式为一个状态行，包括信息的协议版本号、一个成功或者错误的状态码，后面是MIME信息、服务器信息、实体信息和可能的内容。
    - 客户端收到服务器返回的信息，通过浏览器显示在用户屏幕上，断开与服务器的链接 
